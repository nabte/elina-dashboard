(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const a of t.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function r(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function s(e){if(e.ep)return;e.ep=!0;const t=r(e);fetch(e.href,t)}})();const f="https://mytvwfbijlgbihlegmfg.supabase.co",p="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im15dHZ3ZmJpamxnYmlobGVnbWZnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ0MTg5OTAsImV4cCI6MjA2OTk5NDk5MH0.eFL6N7pR4nmpOLywRwxZS_sEWwSbq5WGAnY0zBMreDE";function y(){const n=JSON.parse(localStorage.getItem("impersonated_user_info")||"null"),o=localStorage.getItem("superadmin_session_tokens");let r={};return n&&o?(console.log(`Modo suplantación activo. Actuando como: ${n.id}`),r={global:{headers:{"X-Impersonated-User-ID":n.id}}}):n&&!o&&localStorage.removeItem("impersonated_user_info"),window.supabase.createClient(f,p,r)}window.auth={sb:y(),session:null,handleAuthStateChange(n,o){this.session=o;const r=window.location.pathname.endsWith("/")||window.location.pathname.endsWith("/index.html");if(o&&r){window.location.href="/dashboard.html";return}if(!o&&!r){window.location.href="/";return}document.dispatchEvent(new CustomEvent("auth:ready",{detail:{session:o}}))},getSession(){return this.session},async handleLogin(n){var e,t;n.preventDefault();const o=n.target,r=(e=document.getElementById("login-email"))==null?void 0:e.value,s=(t=document.getElementById("login-password"))==null?void 0:t.value;this.setLoadingState(o,!0,"Verificando...");try{if(!r||!s)throw new Error("Credenciales incompletas");const{error:a}=await this.sb.auth.signInWithPassword({email:r,password:s});if(a)throw a}catch(a){const i=a.message==="Invalid login credentials"?"Correo o contraseña incorrectos.":a.message;this.setLoadingState(o,!1,"Iniciar Sesión",i)}},async handleRegister(n){var a,i,u,h;n.preventDefault();const o=n.target,r=(a=document.getElementById("register-email"))==null?void 0:a.value,s=(i=document.getElementById("register-password"))==null?void 0:i.value,e=(u=document.getElementById("register-name"))==null?void 0:u.value,t=window.iti?window.iti.getNumber():(h=document.getElementById("register-phone"))==null?void 0:h.value;this.setLoadingState(o,!0,"Creando...");try{if(!r||!s||!e||!t)throw new Error("Todos los campos son obligatorios.");const{data:l,error:g}=await this.sb.auth.signUp({email:r,password:s,options:{data:{full_name:e,phone:t}}});if(g)throw g;if(l.user){const c=new Date;c.setDate(c.getDate()+7);const{error:d}=await this.sb.from("subscriptions").insert({user_id:l.user.id,trial_ends_at:c.toISOString()});d&&console.error("Error creando la suscripción de prueba:",d)}if(l.user){try{await fetch("https://n8n-n8n.mcjhhb.easypanel.host/webhook/volution-instance-create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({nombre:e,email:r,telefono_admin:t,Passwr:s})})}catch(d){console.error("Error al llamar al webhook de n8n, pero el registro de usuario continuó:",d)}o.style.display="none";const c=document.getElementById("register-success-message");c.classList.remove("hidden"),lucide.createIcons({nodes:[c.querySelector("i")]})}}catch(l){this.setLoadingState(o,!1,"Crear Cuenta",l.message)}},async handleLogout(){try{await this.sb.auth.signOut()}catch(n){console.error("[Logout Error]",n)}},setLoadingState(n,o,r,s=null){const e=n.querySelector('button[type="submit"]'),t=e.querySelector(".button-text"),a=e.querySelector(".loading-spinner"),i=document.getElementById("error-message"),u=document.getElementById("error-text");o?(e.disabled=!0,a.classList.remove("hidden"),t.textContent=r,i.style.display="none"):(e.disabled=!1,a.classList.add("hidden"),t.textContent=r,s?(u.textContent=s,i.style.display="flex",console.error("[Auth Error]",s)):i.style.display="none")}};window.auth.sb.auth.onAuthStateChange((n,o)=>{window.auth.handleAuthStateChange(n,o)});let m;window.showToast=(n,o="success",r=5e3)=>{const s=document.getElementById("toast-notification"),e=document.getElementById("toast-message"),t=document.getElementById("toast-icon");!s||!e||!t||(m&&clearTimeout(m),e.textContent=n,s.classList.remove("bg-green-500","bg-red-500","bg-blue-500"),s.classList.remove("translate-y-[150%]"),o==="success"?(s.classList.add("bg-green-500"),t.setAttribute("data-lucide","check-circle")):o==="error"?(s.classList.add("bg-red-500"),t.setAttribute("data-lucide","alert-circle")):(s.classList.add("bg-blue-500"),t.setAttribute("data-lucide","info")),lucide.createIcons(),s.classList.remove("hidden"),s.classList.remove("translate-x-[120%]"),m=setTimeout(()=>s.classList.add("translate-x-[120%]"),r))};
