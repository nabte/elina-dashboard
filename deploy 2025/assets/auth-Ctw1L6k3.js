(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&t(i)}).observe(document,{childList:!0,subtree:!0});function r(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function t(e){if(e.ep)return;e.ep=!0;const o=r(e);fetch(e.href,o)}})();const f="https://mytvwfbijlgbihlegmfg.supabase.co",p="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im15dHZ3ZmJpamxnYmlobGVnbWZnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ0MTg5OTAsImV4cCI6MjA2OTk5NDk5MH0.eFL6N7pR4nmpOLywRwxZS_sEWwSbq5WGAnY0zBMreDE";function w(){const n=JSON.parse(localStorage.getItem("impersonated_user_info")||"null"),s=localStorage.getItem("superadmin_session_tokens");let r={};return n&&s?(console.log(`Modo suplantación activo. Actuando como: ${n.id}`),r={global:{headers:{"X-Impersonated-User-ID":n.id}}}):n&&!s&&localStorage.removeItem("impersonated_user_info"),window.supabase.createClient(f,p,r)}window.auth={sb:w(),session:null,handleAuthStateChange(n,s){this.session=s;const r=window.location.pathname.endsWith("/")||window.location.pathname.endsWith("/index.html");if(s&&r){this.sb.rpc("get_user_team_info").then(({data:t,error:e})=>{if(e){console.error("Error fetching team info:",e),window.location.href="/dashboard.html";return}t&&t.role==="admin"?window.location.href="/company-admin.html":window.location.href="/dashboard.html"});return}if(!s&&!r){window.location.href="/";return}document.dispatchEvent(new CustomEvent("auth:ready",{detail:{session:s}}))},getSession(){return this.session},async handleLogin(n){var e,o;n.preventDefault();const s=n.target,r=(e=document.getElementById("login-email"))==null?void 0:e.value,t=(o=document.getElementById("login-password"))==null?void 0:o.value;this.setLoadingState(s,!0,"Verificando...");try{if(!r||!t)throw new Error("Credenciales incompletas");const{error:i}=await this.sb.auth.signInWithPassword({email:r,password:t});if(i)throw i}catch(i){const a=i.message==="Invalid login credentials"?"Correo o contraseña incorrectos.":i.message;this.setLoadingState(s,!1,"Iniciar Sesión",a)}},async handleRegister(n){var i,a,u,h;n.preventDefault();const s=n.target,r=(i=document.getElementById("register-email"))==null?void 0:i.value,t=(a=document.getElementById("register-password"))==null?void 0:a.value,e=(u=document.getElementById("register-name"))==null?void 0:u.value,o=window.iti?window.iti.getNumber():(h=document.getElementById("register-phone"))==null?void 0:h.value;this.setLoadingState(s,!0,"Creando...");try{if(!r||!t||!e||!o)throw new Error("Todos los campos son obligatorios.");const{data:l,error:g}=await this.sb.auth.signUp({email:r,password:t,options:{data:{full_name:e,phone:o}}});if(g)throw g;if(l.user){const c=new Date;c.setDate(c.getDate()+7);const{error:d}=await this.sb.from("subscriptions").insert({user_id:l.user.id,trial_ends_at:c.toISOString()});d&&console.error("Error creando la suscripción de prueba:",d)}if(l.user){try{await fetch("https://n8n-n8n.mcjhhb.easypanel.host/webhook/volution-instance-create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({nombre:e,email:r,telefono_admin:o,Passwr:t})})}catch(d){console.error("Error al llamar al webhook de n8n, pero el registro de usuario continuó:",d)}s.style.display="none";const c=document.getElementById("register-success-message");c.classList.remove("hidden"),lucide.createIcons({nodes:[c.querySelector("i")]})}}catch(l){this.setLoadingState(s,!1,"Crear Cuenta",l.message)}},async handleLogout(){try{await this.sb.auth.signOut()}catch(n){console.error("[Logout Error]",n)}},setLoadingState(n,s,r,t=null){const e=n.querySelector('button[type="submit"]'),o=e.querySelector(".button-text"),i=e.querySelector(".loading-spinner"),a=document.getElementById("error-message"),u=document.getElementById("error-text");s?(e.disabled=!0,i.classList.remove("hidden"),o.textContent=r,a.style.display="none"):(e.disabled=!1,i.classList.add("hidden"),o.textContent=r,t?(u.textContent=t,a.style.display="flex",console.error("[Auth Error]",t)):a.style.display="none")}};window.auth.sb.auth.onAuthStateChange((n,s)=>{window.auth.handleAuthStateChange(n,s)});let m;window.showToast=(n,s="success",r=5e3)=>{const t=document.getElementById("toast-notification"),e=document.getElementById("toast-message"),o=document.getElementById("toast-icon");!t||!e||!o||(m&&clearTimeout(m),e.textContent=n,t.classList.remove("bg-green-500","bg-red-500","bg-blue-500"),t.classList.remove("translate-y-[150%]"),s==="success"?(t.classList.add("bg-green-500"),o.setAttribute("data-lucide","check-circle")):s==="error"?(t.classList.add("bg-red-500"),o.setAttribute("data-lucide","alert-circle")):(t.classList.add("bg-blue-500"),o.setAttribute("data-lucide","info")),lucide.createIcons(),t.classList.remove("hidden"),t.classList.remove("translate-x-[120%]"),m=setTimeout(()=>t.classList.add("translate-x-[120%]"),r))};
