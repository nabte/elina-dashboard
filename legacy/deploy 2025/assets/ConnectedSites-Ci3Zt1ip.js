import{a as M,r as l,u as P,j as e,S as E,t as U,q as T,b as L,g as q,w as B}from"./index-Czd6NKCg.js";import{E as O,T as $}from"./TrashIcon-Ci5YusOZ.js";import{a as A,E as W,P as R}from"./AppContent-CQwVeAxa.js";const z={type:"wordpress",name:"",url:"",username:"",appPassword:"",webhookUrl:"",logoUrl:"",primaryColor:"#3b82f6",accentColor:"#10b981",siteDescription:""},H=({onClose:c,siteToEdit:n,siteCount:S})=>{const{user:i}=M(),[b,p]=l.useState(!1),[x,d]=l.useState(null),[m,y]=l.useState(!1),[h,k]=l.useState(null),[j,g]=l.useState(!1),[t,w]=l.useState(z),[N,a]=l.useState(!1),{t:s}=P();l.useEffect(()=>{n&&w(n)},[n]);const u=o=>{let{name:f,value:v}=o.target;f==="appPassword"&&(v=v.replace(/\s/g,"")),w({...t,[f]:v})},F=o=>{w({...t,[o.target.name]:o.target.value})},C=o=>{w({...t,type:o})},r=async()=>{y(!0),k(null),d(null);const o=await U(t);k(o),y(!1)},I=async o=>{if(o.preventDefault(),d(null),k(null),!!i){p(!0);try{if(t.type==="wordpress"&&t.url&&t.username&&t.appPassword){const{success:f,message:v}=await U(t);if(!f){d(v),p(!1);return}}n?await T(n.id,t):await L(i.id,t),c()}catch(f){d(f instanceof Error?f.message:s("connectedSites.errors.add"))}finally{p(!1)}}},D=!n&&(i==null?void 0:i.plan)==="free"&&i.role!=="superadmin"&&S>=1;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",onClick:c,children:e.jsxs("div",{className:"bg-gray-900/70 backdrop-blur-lg border border-white/20 text-white rounded-lg shadow-2xl w-full max-w-lg",onClick:o=>o.stopPropagation(),children:[e.jsxs("header",{className:"p-4 border-b border-white/20 flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold",children:s(n?"connectedSites.editTitle":"connectedSites.connectNew")}),e.jsx("button",{onClick:c,className:"text-gray-400 hover:text-white transition",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"p-6 max-h-[80vh] overflow-y-auto",children:e.jsxs("form",{onSubmit:I,className:"space-y-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:s("connectedSites.connectionType")}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{type:"button",onClick:()=>C("wordpress"),className:`px-4 py-2 rounded-md text-sm font-medium transition ${t.type==="wordpress"?"bg-[#FFE500] text-black":"bg-gray-700 text-white hover:bg-gray-600"}`,children:"WordPress"}),e.jsx("button",{type:"button",onClick:()=>C("webhook"),className:`px-4 py-2 rounded-md text-sm font-medium transition ${t.type==="webhook"?"bg-[#FFE500] text-black":"bg-gray-700 text-white hover:bg-gray-600"}`,children:"Webhook"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-300",children:s("connectedSites.siteName")}),e.jsx("input",{type:"text",name:"name",id:"name",placeholder:s("connectedSites.siteNamePlaceholder"),value:t.name,onChange:u,className:"mt-1 block w-full p-2 border border-gray-600 rounded-md bg-gray-800 focus:ring-[#FFE500] focus:border-[#FFE500]",required:!0})]}),t.type==="wordpress"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"url",className:"block text-sm font-medium text-gray-300",children:s("connectedSites.siteUrl")}),e.jsx("input",{type:"url",name:"url",id:"url",placeholder:"https://example.com",value:t.url,onChange:u,className:"mt-1 block w-full p-2 border border-gray-600 rounded-md bg-gray-800 focus:ring-[#FFE500] focus:border-[#FFE500]",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-300",children:s("connectedSites.username")}),e.jsx("input",{type:"text",name:"username",id:"username",value:t.username,onChange:u,className:"mt-1 block w-full p-2 border border-gray-600 rounded-md bg-gray-800 focus:ring-[#FFE500] focus:border-[#FFE500]",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"appPasswordModal",className:"block text-sm font-medium text-gray-300",children:s("connectedSites.appPassword")}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:j?"text":"password",name:"appPassword",id:"appPasswordModal",value:t.appPassword,onChange:u,className:"mt-1 block w-full p-2 border border-gray-600 rounded-md bg-gray-800 focus:ring-[#FFE500] focus:border-[#FFE500]",required:!0}),e.jsx("button",{type:"button",onClick:()=>g(!j),className:"absolute inset-y-0 right-0 px-3 flex items-center text-gray-400 hover:text-white",children:j?e.jsx(A,{className:"h-5 w-5"}):e.jsx(W,{className:"h-5 w-5"})})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:s("connectedSites.appPasswordHelpSpaces")})]})]}),t.type==="webhook"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"webhookUrl",className:"block text-sm font-medium text-gray-300",children:s("connectedSites.webhookUrl")}),e.jsx("input",{type:"url",name:"webhookUrl",id:"webhookUrl",placeholder:"https://yoursite.com/api/new-post",value:t.webhookUrl,onChange:u,className:"mt-1 block w-full p-2 border border-gray-600 rounded-md bg-gray-800 focus:ring-[#FFE500] focus:border-[#FFE500]",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"siteDescription",className:"block text-sm font-medium text-gray-300",children:s("connectedSites.siteDescription")}),e.jsx("textarea",{name:"siteDescription",id:"siteDescription",rows:3,placeholder:s("connectedSites.siteDescriptionPlaceholder"),value:t.siteDescription||"",onChange:F,className:"mt-1 block w-full p-2 border border-gray-600 rounded-md bg-gray-800 focus:ring-[#FFE500] focus:border-[#FFE500]"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:s("connectedSites.siteDescriptionHelp")})]}),e.jsxs("div",{children:[e.jsx("button",{type:"button",onClick:()=>a(!N),className:"text-sm text-yellow-400 hover:underline",children:s(N?"connectedSites.hideBranding":"connectedSites.showBranding")}),N&&e.jsxs("div",{className:"mt-4 p-4 border border-white/20 rounded-md space-y-4 bg-black/20",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"logoUrl",className:"block text-sm font-medium text-gray-300",children:s("connectedSites.logoUrl")}),e.jsx("input",{type:"url",name:"logoUrl",id:"logoUrl",placeholder:"https://example.com/logo.png",value:t.logoUrl,onChange:u,className:"mt-1 block w-full p-2 border border-gray-600 rounded-md bg-gray-800 focus:ring-[#FFE500] focus:border-[#FFE500]"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"primaryColor",className:"block text-sm font-medium text-gray-300",children:s("connectedSites.primaryColor")}),e.jsx("input",{type:"color",name:"primaryColor",id:"primaryColor",value:t.primaryColor,onChange:u,className:"mt-1 block w-full h-10 p-1 border-gray-600 rounded-md bg-gray-700 cursor-pointer"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"accentColor",className:"block text-sm font-medium text-gray-300",children:s("connectedSites.accentColor")}),e.jsx("input",{type:"color",name:"accentColor",id:"accentColor",value:t.accentColor,onChange:u,className:"mt-1 block w-full h-10 p-1 border-gray-600 rounded-md bg-gray-700 cursor-pointer"})]})]})]})]}),x&&e.jsx("p",{className:"text-red-400 text-sm mt-2",children:x}),h&&e.jsx("p",{className:`text-sm mt-2 text-center ${h.success?"text-green-400":"text-red-400"}`,children:h.message}),e.jsxs("div",{className:"pt-4 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:c,className:"bg-gray-700 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-600 transition-colors",children:s("generatedPostCard.cancel")}),t.type==="wordpress"&&e.jsxs("button",{type:"button",onClick:r,disabled:b||m||!t.url||!t.username||!t.appPassword,className:"bg-gray-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-600 disabled:bg-gray-800 disabled:cursor-not-allowed flex items-center transition-colors",children:[m&&e.jsx(E,{}),s("connectedSites.testConnection")]}),e.jsxs("button",{type:"submit",disabled:b||m||D,className:"bg-[#FFE500] text-black font-bold py-2 px-4 rounded-lg hover:bg-yellow-400 disabled:bg-gray-700 disabled:cursor-not-allowed flex items-center transition-colors",children:[b&&e.jsx(E,{}),s(D?"connectedSites.freeLimit":n?"connectedSites.saveChanges":"connectedSites.connectButton")]})]})]})})]})})},G=({isOpen:c,onClose:n,onConfirm:S,title:i,message:b,confirmText:p,cancelText:x,isLoading:d=!1})=>{const{t:m}=P();return c?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] p-4",onClick:n,children:e.jsxs("div",{className:"bg-gray-900/70 backdrop-blur-lg border border-white/20 text-white rounded-lg shadow-2xl w-full max-w-md",onClick:y=>y.stopPropagation(),children:[e.jsx("header",{className:"p-4 border-b border-white/20",children:e.jsx("h2",{className:"text-xl font-bold",children:i})}),e.jsx("div",{className:"p-6",children:e.jsx("p",{className:"text-gray-300",children:b})}),e.jsxs("div",{className:"p-4 bg-black/20 flex justify-end gap-3",children:[e.jsx("button",{onClick:n,disabled:d,className:"bg-gray-700 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-600 transition-colors disabled:opacity-50",children:x||m("confirmationModal.cancel")}),e.jsx("button",{onClick:S,disabled:d,className:"bg-red-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-700 transition-colors disabled:bg-red-800 flex items-center justify-center",children:d?e.jsx(E,{}):p||m("confirmationModal.confirm")})]})]})}):null},V=()=>{const{user:c}=M(),[n,S]=l.useState([]),[i,b]=l.useState(!0),[p,x]=l.useState(null),[d,m]=l.useState(!1),[y,h]=l.useState(!1),[k,j]=l.useState(null),[g,t]=l.useState(null),[w,N]=l.useState(!1),{t:a}=P(),s=async()=>{if(c)try{b(!0),x(null);const r=await q(c.id);S(r)}catch(r){x(r instanceof Error?r.message:a("connectedSites.errors.load"))}finally{b(!1)}};l.useEffect(()=>{s()},[c,a]);const u=r=>{t(r),h(!0)},F=r=>{j(r),m(!0)},C=async()=>{if(!(!c||!g)){x(null),N(!0);try{await B(g.id),await s(),h(!1),t(null)}catch(r){x(r instanceof Error?r.message:a("connectedSites.errors.delete"))}finally{N(!1)}}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg border border-white/20 p-6 rounded-lg shadow-lg max-w-4xl mx-auto text-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold",children:a("connectedSites.listTitle")}),e.jsxs("button",{onClick:()=>{j(null),m(!0)},className:"flex items-center bg-[#FFE500] text-black font-bold py-2 px-4 rounded-lg hover:bg-yellow-400 transition-colors",children:[e.jsx(R,{className:"mr-2 h-5 w-5"}),a("connectedSites.connectNew")]})]}),p&&e.jsx("p",{className:"text-red-400 text-sm mb-4",children:p}),i?e.jsx("p",{children:a("connectedSites.loading")}):n.length===0?e.jsx("div",{className:"text-center py-8 border-2 border-dashed border-gray-600 rounded-lg",children:e.jsx("p",{className:"text-gray-400",children:a("connectedSites.noSites")})}):e.jsx("ul",{className:"space-y-4",children:n.map(r=>e.jsxs("li",{className:"flex justify-between items-start p-4 bg-black/20 rounded-md border border-white/20",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("p",{className:"font-semibold text-lg",children:r.name}),e.jsx("span",{className:`text-xs font-semibold px-2 py-0.5 rounded-full ${r.type==="wordpress"?"bg-blue-800 text-blue-200":"bg-purple-800 text-purple-200"}`,children:r.type})]}),e.jsx("p",{className:"text-sm text-gray-400 break-all",children:r.type==="wordpress"?r.url:r.webhookUrl||"N/A"}),r.siteDescription&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1 italic",children:['"',r.siteDescription.length>60?`${r.siteDescription.substring(0,60)}...`:r.siteDescription,'"']})]}),e.jsxs("div",{className:"flex items-center ml-4 space-x-2",children:[e.jsx("button",{onClick:()=>F(r),className:"text-blue-400 hover:text-blue-300 p-1 transition-colors",title:a("connectedSites.edit"),children:e.jsx(O,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>u(r),className:"text-red-400 hover:text-red-500 p-1 transition-colors",title:a("connectedSites.delete"),children:e.jsx($,{className:"h-5 w-5"})})]})]},r.id))})]}),d&&e.jsx(H,{siteToEdit:k,siteCount:n.length,onClose:()=>{m(!1),s()}}),e.jsx(G,{isOpen:y,onClose:()=>h(!1),onConfirm:C,title:a("connectedSites.deleteTitle"),message:a("connectedSites.deleteMessage",{siteName:(g==null?void 0:g.name)||""}),isLoading:w})]})};export{V as ConnectedSites};
