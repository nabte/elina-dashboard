import{a as K,r,u as M,j as e,S as L,m as O,g as Q,o as U}from"./index-Czd6NKCg.js";import{P as W,R as X}from"./PreviewModal-CNZOwO7S.js";import{E as Y}from"./AppContent-CQwVeAxa.js";const ae=({onRetry:g})=>{const{user:i}=K(),[o,x]=r.useState([]),[u,c]=r.useState(new Map),[l,n]=r.useState(!0),[p,v]=r.useState(null),{t:s}=M(),[T,S]=r.useState(!1),[C,q]=r.useState(null),[b,A]=r.useState(""),[f,R]=r.useState(""),[w,V]=r.useState(""),[N,F]=r.useState("scheduled"),[h,k]=r.useState({currentPage:1,itemsPerPage:10}),[$,D]=r.useState(null),y=async()=>{if(i)try{n(!0);const[t,a]=await Promise.all([O(i.id),Q(i.id)]),d=t.sort((m,J)=>new Date(J.publishDate).getTime()-new Date(m.publishDate).getTime());x(d),c(new Map(a.map(m=>[m.id,m]))),v(null)}catch(t){v(t instanceof Error?t.message:s("contentCalendar.errorLoading"))}finally{n(!1)}};r.useEffect(()=>{y();const t=setInterval(()=>{i&&y()},3e4);return()=>clearInterval(t)},[i,s]);const j=r.useMemo(()=>o.filter(t=>{const a=b?t.post.title.toLowerCase().includes(b.toLowerCase()):!0,d=f?t.siteId===f:!0,m=w?t.status===w:!0;return a&&d&&m}),[o,b,f,w]),I=r.useMemo(()=>{const t=new Date;return j.filter(a=>{const d=new Date(a.publishDate);return d>t||a.status==="queued"&&d<=t})},[j]),E=r.useMemo(()=>{const t=new Date;return j.filter(a=>new Date(a.publishDate)<=t&&a.status!=="queued"||a.status==="published"||a.status==="failed"||a.status==="draft")},[j]),P=N==="scheduled"?I:E,H=r.useMemo(()=>{const t=(h.currentPage-1)*h.itemsPerPage;return P.slice(t,t+h.itemsPerPage)},[P,h]),z=t=>{q(t),S(!0)},B=async t=>{const a=u.get(t.siteId);if(!a||!i){v(s("generatedPostCard.errors.selectSite"));return}D(t.id);try{await U(t.id,t.post,a),await y()}catch{await y()}D(null)},G=t=>{const a={queued:s("contentCalendar.statuses.queued"),published:s("contentCalendar.statuses.published"),draft:s("generatedPostCard.draft"),failed:s("contentCalendar.statuses.failed")},d={queued:"bg-yellow-900 text-yellow-300",published:"bg-green-900 text-green-300",draft:"bg-blue-900 text-blue-300",failed:"bg-red-900 text-red-300"};return e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${d[t]}`,children:a[t]})};return l?e.jsxs("div",{className:"text-center p-8 text-white",children:[e.jsx(L,{large:!0})," ",e.jsx("p",{className:"mt-2",children:s("contentCalendar.loading")})]}):p?e.jsx("p",{className:"text-red-400 text-center",children:p}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg border border-white/20 p-6 rounded-lg shadow-lg w-[90%] mx-auto text-white mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:s("contentCalendar.title")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 p-4 bg-black/20 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"filter-title",className:"block text-xs font-medium text-gray-400 mb-1",children:s("contentCalendar.filters.title")}),e.jsx("input",{id:"filter-title",type:"text",placeholder:s("contentCalendar.filters.titlePlaceholder"),value:b,onChange:t=>A(t.target.value),className:"w-full p-2 border border-gray-600 rounded-md bg-gray-800 text-white focus:ring-[#FFE500] focus:border-[#FFE500] transition text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"filter-site",className:"block text-xs font-medium text-gray-400 mb-1",children:s("contentCalendar.filters.destination")}),e.jsxs("select",{id:"filter-site",value:f,onChange:t=>R(t.target.value),className:"w-full p-2 border border-gray-600 rounded-md bg-gray-800 text-white focus:ring-[#FFE500] focus:border-[#FFE500] transition text-sm",children:[e.jsx("option",{value:"",children:s("contentCalendar.filters.allSites")}),Array.from(u.values()).map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"filter-status",className:"block text-xs font-medium text-gray-400 mb-1",children:s("contentCalendar.filters.status")}),e.jsxs("select",{id:"filter-status",value:w,onChange:t=>V(t.target.value),className:"w-full p-2 border border-gray-600 rounded-md bg-gray-800 text-white focus:ring-[#FFE500] focus:border-[#FFE500] transition text-sm",children:[e.jsx("option",{value:"",children:s("contentCalendar.filters.allStatuses")}),e.jsx("option",{value:"queued",children:s("contentCalendar.statuses.queued")}),e.jsx("option",{value:"published",children:s("contentCalendar.statuses.published")}),e.jsx("option",{value:"draft",children:s("generatedPostCard.draft")}),e.jsx("option",{value:"failed",children:s("contentCalendar.statuses.failed")})]})]})]}),e.jsx("div",{className:"border-b border-white/20 mb-4",children:e.jsxs("nav",{className:"flex -mb-px space-x-6",children:[e.jsxs("button",{onClick:()=>F("scheduled"),className:`py-3 px-1 border-b-2 font-medium text-sm ${N==="scheduled"?"border-yellow-400 text-white":"border-transparent text-gray-400 hover:text-white hover:border-gray-300"}`,children:[s("contentCalendar.scheduledTitle")," (",I.length,")"]}),e.jsxs("button",{onClick:()=>F("history"),className:`py-3 px-1 border-b-2 font-medium text-sm ${N==="history"?"border-yellow-400 text-white":"border-transparent text-gray-400 hover:text-white hover:border-gray-300"}`,children:[s("contentCalendar.historyTitle")," (",E.length,")"]})]})}),e.jsx(Z,{posts:H,sites:u,getStatusChip:G,handlePreview:z,handleRetryClick:B,retryingPostId:$}),e.jsx(_,{totalItems:P.length,itemsPerPage:h.itemsPerPage,currentPage:h.currentPage,onPageChange:t=>k(a=>({...a,currentPage:t})),onItemsPerPageChange:t=>k({currentPage:1,itemsPerPage:t})})]}),T&&C&&e.jsx(W,{htmlContent:C.htmlContent,title:C.title,onClose:()=>S(!1)})]})},Z=({posts:g,sites:i,getStatusChip:o,handlePreview:x,handleRetryClick:u,retryingPostId:c})=>{const{t:l}=M();return e.jsx(e.Fragment,{children:g.length===0?e.jsx("p",{className:"text-center text-gray-400 py-8",children:l("contentCalendar.noPostsInView")}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-white/20",children:[e.jsx("thead",{className:"bg-black/20",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:l("contentCalendar.headers.title")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:l("contentCalendar.headers.destination")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:l("contentCalendar.headers.publishDate")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:l("contentCalendar.headers.status")}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:l("contentCalendar.headers.actions")})]})}),e.jsx("tbody",{className:"divide-y divide-white/20",children:g.map(n=>{var p;return e.jsxs("tr",{className:"hover:bg-black/10",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-white max-w-xs truncate",title:n.post.title,children:n.post.title}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-400",children:((p=i.get(n.siteId))==null?void 0:p.name)||l("contentCalendar.unknownSite")}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-400",children:new Date(n.publishDate).toLocaleString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:o(n.status)}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-center space-x-4",children:[n.status==="failed"&&c!==n.id&&e.jsx("button",{onClick:()=>u(n),className:"text-blue-400 hover:text-blue-300",title:l("generatedPostCard.retry"),children:e.jsx(X,{className:"h-5 w-5"})}),c===n.id&&e.jsx("div",{className:"flex justify-center",children:e.jsx(L,{})}),e.jsx("button",{onClick:()=>x(n.post),className:"text-yellow-400 hover:text-yellow-300",title:l("contentCalendar.preview"),children:e.jsx(Y,{className:"h-5 w-5"})})]})]},n.id)})})]})})})},_=({totalItems:g,itemsPerPage:i,currentPage:o,onPageChange:x,onItemsPerPageChange:u})=>{const c=Math.ceil(g/i);return c<=1?null:e.jsxs("div",{className:"flex items-center justify-between mt-4 text-sm text-gray-300",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"Mostrar"}),e.jsxs("select",{value:i,onChange:l=>u(Number(l.target.value)),className:"p-1 border border-gray-600 rounded-md bg-gray-800 text-white focus:ring-[#FFE500] focus:border-[#FFE500] transition",children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"})]}),e.jsx("span",{children:"por página"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>x(o-1),disabled:o===1,className:"px-3 py-1 border border-gray-600 rounded-md bg-gray-800 hover:bg-gray-700 disabled:opacity-50",children:"Anterior"}),e.jsxs("span",{children:["Página ",o," de ",c]}),e.jsx("button",{onClick:()=>x(o+1),disabled:o===c,className:"px-3 py-1 border border-gray-600 rounded-md bg-gray-800 hover:bg-gray-700 disabled:opacity-50",children:"Siguiente"})]})]})};export{ae as ContentCalendar};
