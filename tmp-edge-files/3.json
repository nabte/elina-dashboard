{"name":"config/types.ts","content":"/**\r\n * ELINA V5 - Type Definitions\r\n */\r\n\r\nimport type { SupabaseClient } from 'https://esm.sh/@supabase/supabase-js@2'\r\n\r\n// ============================================================================\r\n// Account Configuration\r\n// ============================================================================\r\n\r\nexport interface AccountConfig {\r\n    // Identification\r\n    userId: string\r\n    instanceName: string\r\n    serverUrl: string\r\n\r\n    // AI Configuration\r\n    model: string\r\n    temperature: number\r\n    maxTokens: number\r\n\r\n    // Company Info\r\n    companyName: string\r\n    companyDescription: string\r\n    website?: string\r\n    businessAddress?: string\r\n    businessPhone?: string\r\n    timezone: string\r\n    slug?: string // Company unique slug for profile link\r\n\r\n    // Personality\r\n    tone: 'profesional' | 'casual' | 'amigable' | 'formal'\r\n    customPrompt?: string\r\n\r\n    // Business Capabilities\r\n    businessType: 'ecommerce' | 'services' | 'hybrid' | 'appointments'\r\n    hasProducts: boolean\r\n    hasServices: boolean\r\n    hasAppointments: boolean\r\n    hasQuotes: boolean\r\n    hasShipping: boolean\r\n    productCount: number\r\n    serviceCount: number\r\n\r\n    // Filters and Rules\r\n    ignoredLabels: string[]\r\n    criticalRules: CriticalRule[]\r\n    autoResponses: AutoResponse[]\r\n\r\n    // Integrations\r\n    evolutionApiKey: string\r\n    evolutionApiUrl: string\r\n    elevenLabsVoiceId?: string\r\n\r\n    // Working Hours\r\n    workStartHour: number\r\n    workEndHour: number\r\n\r\n    // Limits\r\n    maxMessagesPerDay?: number\r\n\r\n    // Features\r\n    quotesEnabled: boolean\r\n    appointmentsEnabled: boolean\r\n    remindersEnabled: boolean\r\n}\r\n\r\n// ============================================================================\r\n// Rules and Responses\r\n// ============================================================================\r\n\r\nexport interface CriticalRule {\r\n    id: number\r\n    ruleName: string\r\n    ruleType: 'keyword' | 'pattern'\r\n    patternOrKeyword: string\r\n    detectionType: string\r\n    isActive: boolean\r\n    priority: number\r\n    caseSensitive: boolean\r\n}\r\n\r\nexport interface AutoResponse {\r\n    id: number\r\n    triggerText: string\r\n    responseText: string\r\n    isActive: boolean\r\n    matchType: 'exact' | 'contains'\r\n    mediaUrl?: string\r\n    mediaType: 'text' | 'image' | 'video' | 'audio' | 'document'\r\n}\r\n\r\n// ============================================================================\r\n// Intent Detection\r\n// ============================================================================\r\n\r\nexport enum Intent {\r\n    // Basic\r\n    GREETING = 'greeting',\r\n    FAREWELL = 'farewell',\r\n    GENERAL_QUESTION = 'general_question',\r\n\r\n    // Business\r\n    PRODUCT_INQUIRY = 'product_inquiry',\r\n    SERVICE_INQUIRY = 'service_inquiry',\r\n    PRICE_INQUIRY = 'price_inquiry',\r\n    STOCK_INQUIRY = 'stock_inquiry',\r\n    APPOINTMENT_REQUEST = 'appointment_request',\r\n    QUOTE_REQUEST = 'quote_request',\r\n    ORDER_STATUS = 'order_status',\r\n\r\n    // Critical\r\n    COMPLAINT = 'complaint',\r\n    URGENT_ISSUE = 'urgent_issue',\r\n    CANCELLATION = 'cancellation',\r\n    REFUND_REQUEST = 'refund_request',\r\n\r\n    // Conversational\r\n    SMALL_TALK = 'small_talk',\r\n    CLARIFICATION = 'clarification',\r\n    CONFIRMATION = 'confirmation',\r\n    OBJECTION = 'objection',\r\n\r\n    // Other\r\n    UNKNOWN = 'unknown'\r\n}\r\n\r\nexport interface IntentDetectionResult {\r\n    primary: Intent\r\n    secondary?: Intent[]\r\n    confidence: number\r\n    sentiment: SentimentAnalysis\r\n    entities: {\r\n        products?: string[]\r\n        services?: string[]\r\n        dates?: string[]\r\n        prices?: number[]\r\n        phoneNumbers?: string[]\r\n    }\r\n}\r\n\r\nexport interface SentimentAnalysis {\r\n    polarity: 'positive' | 'neutral' | 'negative'\r\n    score: number // -1 to 1\r\n    emotions?: string[]\r\n}\r\n\r\n// ============================================================================\r\n// Memory\r\n// ============================================================================\r\n\r\nexport interface ConversationContext {\r\n    // Recent Messages\r\n    recentMessages: Message[]\r\n\r\n    // Conversation Summary\r\n    summary?: string\r\n\r\n    // RAG Context\r\n    ragContext?: string\r\n\r\n    // Business Context\r\n    businessCapabilities?: BusinessCapabilities\r\n    topProducts?: Product[]\r\n    activePromotions?: Promotion[]\r\n    appointmentSlots?: AppointmentSlot[]\r\n    appointmentContext?: string\r\n\r\n    // User Preferences\r\n    userPreferences?: UserPreference[]\r\n\r\n    // Account Learnings\r\n    accountLearnings?: AccountLearning[]\r\n\r\n    // Conversation State (for contextual references)\r\n    conversationState?: ConversationContextState | null\r\n}\r\n\r\nexport interface MentionedProduct {\r\n    id: number\r\n    position: number  // 1, 2, 3... (order shown to user)\r\n    name: string\r\n    price: number\r\n    mentionedAt: string\r\n}\r\n\r\nexport interface CartItem {\r\n    product_id: number\r\n    quantity: number\r\n    addedAt: string\r\n}\r\n\r\nexport interface ConversationContextState {\r\n    lastProductsMentioned: MentionedProduct[]\r\n    tentativeCart: CartItem[]\r\n    lastIntent: string\r\n    lastAgentResponse?: string\r\n    appointmentContext?: any\r\n    potentialService?: {\r\n        id?: number\r\n        name: string\r\n    }\r\n    updatedAt: string\r\n}\r\n\r\nexport interface Message {\r\n    role: 'user' | 'assistant' | 'system'\r\n    content: string\r\n    timestamp?: Date\r\n}\r\n\r\nexport interface BusinessCapabilities {\r\n    primaryBusinessType: string | null\r\n    hasPhysicalProducts: boolean\r\n    productCount: number\r\n    hasServices: boolean\r\n    serviceCount: number\r\n    hasAppointments: boolean\r\n    appointmentCount: number\r\n    hasShippingSystem: boolean\r\n}\r\n\r\nexport interface Product {\r\n    id: number\r\n    productName: string\r\n    sku?: string\r\n    price: number\r\n    stock: number\r\n    description?: string\r\n    mediaUrl?: string\r\n    productType: 'physical' | 'service'\r\n    serviceDurationMinutes?: number\r\n}\r\n\r\nexport interface Promotion {\r\n    id: string\r\n    title: string\r\n    description?: string\r\n    benefits?: string\r\n    callToAction?: string\r\n    imageUrls?: string[]\r\n    discount?: string\r\n    offer?: string\r\n}\r\n\r\nexport interface AppointmentSlot {\r\n    start_time: string\r\n    end_time: string\r\n    service_id: number\r\n    service_name: string\r\n    duration_minutes: number\r\n    available?: boolean\r\n}\r\n\r\nexport interface UserPreference {\r\n    key: string\r\n    value: string\r\n    confidence: number\r\n    lastUpdated: Date\r\n}\r\n\r\nexport interface AccountLearning {\r\n    id: string\r\n    userId: string\r\n    learningType: 'pattern' | 'objection' | 'product_insight' | 'best_practice'\r\n    content: string\r\n    confidence: number\r\n    usageCount: number\r\n    lastUsed?: Date\r\n}\r\n\r\n// ============================================================================\r\n// Agent\r\n// ============================================================================\r\n\r\nexport interface AgentResponse {\r\n    text: string\r\n    toolCalls?: ToolCall[]\r\n    metadata: {\r\n        model: string\r\n        tokensUsed: number\r\n        finishReason: string\r\n        duration?: number\r\n    }\r\n}\r\n\r\nexport interface ToolCall {\r\n    id: string\r\n    type: 'function'\r\n    function: {\r\n        name: string\r\n        arguments: string\r\n    }\r\n}\r\n\r\n// ============================================================================\r\n// Database Types\r\n// ============================================================================\r\n\r\nexport interface Profile {\r\n    id: string\r\n    full_name?: string\r\n    email?: string\r\n    contact_phone?: string\r\n    evolution_instance_name?: string\r\n    evolution_api_key?: string\r\n    evolution_api_url?: string\r\n    company_description?: string\r\n    website?: string\r\n    business_address?: string\r\n    business_phone?: string\r\n    timezone?: string\r\n    slug?: string // Company slug for profile link\r\n    work_start_hour?: number\r\n    work_end_hour?: number\r\n    product_count?: number\r\n    service_count?: number\r\n    business_type?: string\r\n    quotes_enabled?: boolean\r\n    has_shipping_system?: boolean\r\n    // New fields for consolidation\r\n    system_prompt?: string\r\n    prompt_history?: any[]\r\n    appointment_config?: Record<string, any>\r\n    quote_config?: Record<string, any>\r\n    automation_settings?: Record<string, any>\r\n}\r\n\r\nexport interface AutomationRule {\r\n    id: string\r\n    user_id: string\r\n    name: string\r\n    type: 'critical' | 'auto_response' | 'promotion' | 'label_assignment'\r\n    trigger_type: 'keyword' | 'pattern' | 'intent' | 'schedule'\r\n    trigger_config: Record<string, any>\r\n    action_type: 'reply' | 'assign_label' | 'notify' | 'insert_content'\r\n    action_config: Record<string, any>\r\n    priority: number\r\n    is_active: boolean\r\n    created_at: string\r\n}\r\n\r\nexport interface Contact {\r\n    id: number\r\n    user_id: string\r\n    phone_number: string\r\n    full_name?: string\r\n    labels?: string[]\r\n    followup_status?: string\r\n    is_simulation?: boolean\r\n}\r\n\r\nexport interface Team {\r\n    id: string\r\n    owner_id: string\r\n    name: string\r\n    ignored_labels?: string[]\r\n}\r\n\r\nexport interface ConversationState {\r\n    id: number\r\n    contact_id: number\r\n    user_id: string\r\n    is_paused: boolean\r\n    pause_reason?: string\r\n    paused_at?: Date\r\n}\r\n\r\n// ============================================================================\r\n// Utility Types\r\n// ============================================================================\r\n\r\nexport interface FilterResult {\r\n    ignore: boolean\r\n    reason?: string\r\n}\r\n\r\nexport interface MediaProcessingResult {\r\n    transcription?: string\r\n    description?: string\r\n    mediaType: 'image' | 'audio' | 'video' | 'document'\r\n    success: boolean\r\n    error?: string\r\n}\r\n\r\nexport interface QuoteItem {\r\n    product_id: number\r\n    product_name: string\r\n    quantity: number\r\n    price: number\r\n    subtotal: number\r\n}\r\n\r\n\r\nexport interface PlaceholderResult {\r\n    finalText: string\r\n    productIds: number[]\r\n    productsMap: Record<string, Product>\r\n    shouldGenerateQuote: boolean\r\n    quoteItems: QuoteItem[]\r\n}\r\n\r\n// ============================================================================\r\n// Tool Calling\r\n// ============================================================================\r\n\r\nexport interface ToolCall {\r\n    id: string\r\n    type: 'function'\r\n    function: {\r\n        name: string\r\n        arguments: string  // JSON string\r\n    }\r\n}\r\n\r\nexport interface ToolResult {\r\n    tool_call_id: string\r\n    role: 'tool'\r\n    name: string\r\n    content: string  // JSON string\r\n}\r\n"}